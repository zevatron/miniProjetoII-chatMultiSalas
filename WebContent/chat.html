<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Websocket Chat</title>

<link href="chat.css" rel="stylesheet">
<link
	href="https://stackpath.bootstrapcdn.com/bootswatch/4.1.1/materia/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-B7n8QuRe6UtnoLRAwGkku55zwnr4h8whf+ThXUwwlP9SaeNzHlGR4cOOuEZVMYOL"
	crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
	integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
	crossorigin="anonymous"></script>
<script>
	  $(function () {
		  var params = (new URL(document.location)).searchParams;
		  var sala = params.get("sala"); 
		  var user = params.get("nickname");
		  var socket = new WebSocket("ws://" +document.location.host + "/chatMultiSalas/" +sala +"/"+user);
		  if(socket){
			  $('#navbarDropdownMenuLinkUser').text(user);
		  }
			$('form').submit(function() {
				if($('#m').val().length > 0){
					var msg = "send " + $('#m').val();
					socket.send(msg);
					$('#m').val('');					
				}
				return false;
			});

			socket.onmessage = function(event) {
				msg = event.data;
				$('#messages').append($('<li>').text(msg));
			};

		});
	</script>
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
		<a class="navbar-brand" href="#">ChatMultiSalas</a>


		<ul class="nav navbar-nav ml-auto">
			<li class="nav-item dropdown"><a
				class="nav-link dropdown-toggle" href="#"
				id="navbarDropdownMenuLinkUser" data-toggle="dropdown"
				aria-haspopup="true" aria-expanded="false"> </a>
				<div class="dropdown-menu dropdown-menu-right"
					aria-labelledby="navbarDropdownMenuLinkUser">
					<a class="dropdown-item" href="#">Renomear usuário</a> <a
						class="dropdown-item" href="index.html">Sair da sala</a>
				</div>
			</li>

		</ul>


	</nav>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-9">
				<ul id="messages"></ul>

			</div>
			<div class="col-md-3" id="users">
				<h3>Usuários</h3>
				<div class="list-group">
					<ul >
						<li class="list-group-item list-group-item-action active">um</li>
						<li class="list-group-item list-group-item-action">dois</li>
						<li class="list-group-item list-group-item-action">tres</li>
					</ul>

				</div>
			</div>
		</div>
	</div>
	<form action="">
		<input id="m" autocomplete="off" autofocus="autofocus" />
		<button type="button" class="btn btn-primary">Enviar</button>
	</form>
</body>
</html>